<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <!-- 适配手机屏幕 -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>点菜网页</title>
  <style>
    /* 基础重置 */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    /* 整体页面风格 */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 10px;
      background-color: #f2f2f2;
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    .container {
      background-color: rgba(255,255,255,0.95);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 95%;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
      color: #333;
      margin-bottom: 15px;
    }
    .form-group {
      margin-bottom: 15px;
      text-align: center;
    }
    input[type="text"],
    input[type="file"] {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 90%;
      max-width: 400px;
      margin: auto;
      display: block;
    }
    button {
      padding: 10px 20px;
      background: linear-gradient(45deg, #1aad19, #159d14);
      color: #fff;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
      transition: background 0.3s;
    }
    button:hover {
      background: linear-gradient(45deg, #159d14, #1aad19);
    }
    .dish-list {
      margin-top: 20px;
    }
    .dish-item {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      flex-wrap: wrap;
    }
    .dish-item img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      margin-right: 10px;
      border-radius: 8px;
      cursor: pointer;
      flex-shrink: 0;
    }
    .dish-name {
      margin-right: 10px;
      white-space: nowrap;
      font-weight: bold;
      color: #333;
      flex-shrink: 0;
    }
    .remark-input {
      flex-grow: 1;
      padding: 5px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-top: 5px;
    }
    /* 随机选菜区域 */
    .random-result {
      margin-top: 20px;
      text-align: center;
      padding: 15px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .random-result img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    /* Modal 样式 */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.8);
      padding-top: 60px;
    }
    .modal-content {
      margin: auto;
      display: block;
      width: 80%;
      max-width: 700px;
      border-radius: 8px;
    }
    .close {
      position: absolute;
      top: 30px;
      right: 35px;
      color: #fff;
      font-size: 40px;
      font-weight: bold;
      cursor: pointer;
    }
    /* 背景图片自定义样式 */
    .bg-customize {
      text-align: center;
      margin-bottom: 15px;
    }
    /* 手机屏幕适配调整 */
    @media (max-width: 480px) {
      h1, h2 {
        font-size: 20px;
      }
      button, input[type="text"] {
        font-size: 14px;
      }
      .dish-item img {
        width: 50px;
        height: 50px;
      }
      .random-result img {
        width: 120px;
        height: 120px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>点菜网页</h1>
    
    <!-- 开发者配置区域 -->
    <div id="devPanel">
      <h2>开发者配置区</h2>
      <div class="bg-customize form-group">
        <input type="file" id="bgImage" accept="image/*">
        <p>选择自定义背景图片</p>
      </div>
      <div class="form-group">
        <input type="text" id="dishName" placeholder="请输入菜名，如果留空将使用图片文件名">
      </div>
      <div class="form-group">
        <input type="file" id="dishImage" accept="image/*">
      </div>
      <div class="form-group">
        <button id="addDishBtn">添加菜品</button>
      </div>
      <div class="form-group">
        <button id="saveConfigBtn">保存配置</button>
      </div>
      <h2>菜品预览</h2>
      <div id="dishList" class="dish-list"></div>
    </div>
    
    <!-- 用户使用区域（配置保存后显示） -->
    <div id="userPanel" style="display:none;">
      <h2>请选择菜品</h2>
      <div id="userDishList" class="dish-list"></div>
      <div class="form-group">
        <button id="randomDishBtn">随机选菜</button>
      </div>
      <div class="form-group">
        <button id="confirmSelectionBtn" style="display:none;">已选好</button>
      </div>
      <div id="randomResult" class="random-result" style="display: none;">
        <h2>随机选中的菜</h2>
        <img id="randomDishImage" src="" alt="选中的菜图片">
        <p id="randomDishName"></p>
      </div>
    </div>
    
    <!-- 放大图片的 Modal -->
    <div id="modal" class="modal">
      <span id="closeModal" class="close">&times;</span>
      <img class="modal-content" id="modalImage" alt="放大图片">
    </div>
  </div>
  
  <script>
    // 全局变量
    let dishes = [];
    let currentSelectedDish = null;
    let backgroundImage = "";
    
    // 开发者面板元素
    const devPanel = document.getElementById('devPanel');
    // 用户面板元素
    const userPanel = document.getElementById('userPanel');
    
    const dishNameInput = document.getElementById('dishName');
    const dishImageInput = document.getElementById('dishImage');
    const addDishBtn = document.getElementById('addDishBtn');
    const saveConfigBtn = document.getElementById('saveConfigBtn');
    const dishListDiv = document.getElementById('dishList');
    
    // 用户面板中的元素
    const userDishListDiv = document.getElementById('userDishList');
    const randomDishBtn = document.getElementById('randomDishBtn');
    const confirmSelectionBtn = document.getElementById('confirmSelectionBtn');
    const randomResultDiv = document.getElementById('randomResult');
    const randomDishImage = document.getElementById('randomDishImage');
    const randomDishName = document.getElementById('randomDishName');
    
    // 通用元素
    const bgImageInput = document.getElementById('bgImage');
    const modal = document.getElementById('modal');
    const modalImage = document.getElementById('modalImage');
    const closeModal = document.getElementById('closeModal');
    
    // 开发者模式：添加菜品
    function addDish() {
      let name = dishNameInput.value.trim();
      const file = dishImageInput.files[0];
      if (!file) {
        alert('请选择图片！');
        return;
      }
      if (!name) {
        name = file.name.replace(/\.[^/.]+$/, "");
      }
      const reader = new FileReader();
      reader.onload = function(e) {
        const imageSrc = e.target.result;
        const dish = {
          name: name,
          image: imageSrc,
          remark: ""
        };
        dishes.push(dish);
        renderDevDishList();
        dishNameInput.value = '';
        dishImageInput.value = '';
      };
      reader.readAsDataURL(file);
    }
    
    // 渲染开发者面板中的菜品预览列表
    function renderDevDishList() {
      dishListDiv.innerHTML = '';
      dishes.forEach((dish, index) => {
        const dishItem = document.createElement('div');
        dishItem.className = 'dish-item';
        const img = document.createElement('img');
        img.src = dish.image;
        img.alt = dish.name;
        img.addEventListener('click', function() {
          showModal(dish.image);
        });
        const nameSpan = document.createElement('span');
        nameSpan.className = 'dish-name';
        nameSpan.textContent = dish.name;
        dishItem.appendChild(img);
        dishItem.appendChild(nameSpan);
        dishListDiv.appendChild(dishItem);
      });
    }
    
    // 保存配置（开发者点击保存后，将配置存入 localStorage 并切换至用户模式）
    function saveConfig() {
      const config = {
        dishes: dishes,
        background: backgroundImage
      };
      localStorage.setItem('config', JSON.stringify(config));
      alert('配置已保存！将进入用户模式。');
      switchToUserMode();
    }
    
    // 切换到用户模式：隐藏开发者面板，显示用户面板，并加载配置
    function switchToUserMode() {
      devPanel.style.display = 'none';
      userPanel.style.display = 'block';
      loadUserConfig();
    }
    
    // 从 localStorage 加载配置，并渲染用户模式的菜品列表
    function loadUserConfig() {
      const config = localStorage.getItem('config');
      if (config) {
        const parsed = JSON.parse(config);
        dishes = parsed.dishes || [];
        backgroundImage = parsed.background || "";
        if (backgroundImage) {
          document.body.style.backgroundImage = `url(${backgroundImage})`;
        }
      }
      renderUserDishList();
    }
    
    // 渲染用户面板中的菜品列表（仅供选择，不再编辑）
    function renderUserDishList() {
      userDishListDiv.innerHTML = '';
      dishes.forEach((dish, index) => {
        const dishItem = document.createElement('div');
        dishItem.className = 'dish-item';
        const img = document.createElement('img');
        img.src = dish.image;
        img.alt = dish.name;
        img.addEventListener('click', function() {
          currentSelectedDish = dish;
          highlightSelectedDish(index);
          showConfirmButton();
        });
        const nameSpan = document.createElement('span');
        nameSpan.className = 'dish-name';
        nameSpan.textContent = dish.name;
        dishItem.appendChild(img);
        dishItem.appendChild(nameSpan);
        userDishListDiv.appendChild(dishItem);
      });
    }
    
    // 高亮显示用户所选的菜品
    function highlightSelectedDish(selectedIndex) {
      const dishItems = userDishListDiv.getElementsByClassName('dish-item');
      for (let i = 0; i < dishItems.length; i++) {
        dishItems[i].style.border = i === selectedIndex ? '2px solid #1aad19' : 'none';
      }
    }
    
    // 显示“已选好”按钮
    function showConfirmButton() {
      confirmSelectionBtn.style.display = 'block';
    }
    
    // 用户点击随机选菜按钮
    function randomDish() {
      if (dishes.length === 0) {
        alert('没有菜品可供选择！');
        return;
      }
      const randomIndex = Math.floor(Math.random() * dishes.length);
      const selectedDish = dishes[randomIndex];
      currentSelectedDish = selectedDish;
      randomDishImage.src = selectedDish.image;
      randomDishName.textContent = selectedDish.name + (selectedDish.remark ? (" - 备注：" + selectedDish.remark) : "");
      randomResultDiv.style.display = 'block';
      highlightSelectedDish(randomIndex);
      showConfirmButton();
    }
    
    // 用户点击“已选好”按钮，保存最终选择
    function confirmSelection() {
      if (!currentSelectedDish) {
        alert('请先选择一个菜品！');
        return;
      }
      localStorage.setItem('userSelection', JSON.stringify(currentSelectedDish));
      alert('您的选择已保存！');
      // 此处可根据需要执行后续操作（例如跳转到其他页面）
    }
    
    // 背景图片上传（开发者模式使用）
    bgImageInput.addEventListener('change', function() {
      const file = bgImageInput.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        backgroundImage = e.target.result;
        document.body.style.backgroundImage = `url(${backgroundImage})`;
      };
      reader.readAsDataURL(file);
    });
    
    // Modal 相关操作
    function showModal(imageSrc) {
      modal.style.display = 'block';
      modalImage.src = imageSrc;
    }
    function hideModal() {
      modal.style.display = 'none';
    }
    closeModal.addEventListener('click', hideModal);
    modal.addEventListener('click', function(event) {
      if (event.target === modal) hideModal();
    });
    
    // 绑定开发者面板事件
    addDishBtn.addEventListener('click', addDish);
    saveConfigBtn.addEventListener('click', saveConfig);
    
    // 绑定用户面板事件
    randomDishBtn.addEventListener('click', randomDish);
    confirmSelectionBtn.addEventListener('click', confirmSelection);
    
    // 页面加载时检查是否存在配置（若存在则直接进入用户模式）
    window.onload = function() {
      const config = localStorage.getItem('config');
      if (config) {
        switchToUserMode();
      }
    };
  </script>
</body>
</html>
